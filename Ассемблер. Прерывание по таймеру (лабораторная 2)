.include "m8def.inc"
  rjmp init
.org OVF1addr	;адрес прерывания по таймеру
  rjmp TIM1_INT
init:
 ldi R16,LOW(RamEnd)
 out SPL,R16
 ldi R16,HIGH(RamEnd)
 out SPH,R16
ldi R17,0b00000001	;делаем PD0 выходом
 out DDRD,R17		
 ldi R17,0b00000011;крайние три бита устанавливают предделитель 64
 out TCCR1B,R17	;устанавливаем конфигурацию таймера
;таймер 1 состоит из двух байт: H - старший, L - младший
;и переполняется после 65536 тактов, нужно отсчитать одну секунду, т.е. 4 ГГц/64 = 62500 тактов (65536-62500 = 3036)
;запишем число 3036 = $BDC, разделенное на два байта: OB, DC
;теперь таймер переполняется через 62500 тактов, т.е. через 1 секунду
 ldi R17,$DC
 out TCNT1L,R17
 ldi R17,$0B
 out TCNT1H,R17
 ;TIMSK отвечает за прерывания
 ldi R17, (1<< TOIE1) ;процессор реагирует на сигнал переполнения ТС1 и вызывает прерывание по вектору $010 (OVF1addr).
 out TIMSK,R17
 sei	;устанавливаем флаг прерываний (разрешаем)
 main_loop:
  nop	;пинаем балду
 rjmp main_loop
TIM1_INT:	;что делать по прерыванию
 out PORTD,R16
 ldi R17, 1
 EOR R16, R17
 ;опять записываем в таймер число 3036
 ldi R17,$DC
 out TCNT1L,R17
 ldi R17,$0B
 out TCNT1H,R17
reti
