.include "m16def.inc" ;ATmega16
.cseg
.org 0x00	;костыль для нормальной работы Proteus, который не воспринимает нормально никакие ячейки памяти, кроме нулевых
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
.dq 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

.org 0x428	;адрес ячейки памяти 850
ldi r16, 0xFF
out DDRB, r16	;порт В на вывод 
ldi r16, 0x00
out DDRA, r16	;порт А на ввод
Main:	;основной цикл
    	in r16, PINA	;запись в регистр r16 сообщения с порта А
	sts 0x450, r16	;запись сообщения в ОЗУ
	
;сохранение информационных битов
	mov r17,r16	;запись сообщения в регистр r17
	andi r17,0x01	;выделение первого информационного бита
	lsl r17
	lsl r17	
	lsl r17		;сдвиг бита влево в четвертый разряд
	
	mov r18,r16	;запись сообщения в регистр r18
	andi r18,0x02	;выделение второго информационного бита
	lsl r18	
	lsl r18		;сдвиг бита влево в четвертый разряд
	
	mov r19,r16	;запись сообщения в регистр r19
	andi r19,0x04	;выделение третьего информационного бита
	lsl r19		;сдвиг бита влево в четвертый разряд
	
	mov r20,r16	;запись сообщения в регистр r20
	andi r20,0x08	;выделение четвертого информационного бита
	
;сохранение проверочных битов
	mov r21, r17	;запись первого информационного бита в регистр r21
	eor r21, r18	
	eor r21, r20	;вычисление первого проверочного бита
	lsl r21		;сдвиг бита в пятый разряд
	
	mov r22,r17	;запись первого информационного бита в регистр r22
	eor r22, r19	
	eor r22, r20	;вычисление второго проверочного бита	
	lsl r22
	lsl r22		;сдвиг бита в шестой разряд

	mov r23,r18	;запись второго информационного бита в регистр r23
	eor r23, r19	
	eor r23, r20	;вычисление третьего проверочного бита
	lsl r23	
	lsl r23
	lsl r23		;сдвиг бита в седьмой разряд
;формирование кода Хемминга
;запись проверочных битов
	or r16, r21
	or r16, r22
	or r16, r23
;вывод закодированных данных
	sts 0x452, r16	;запись кода в ОЗУ
	out PORTB, r16	;вывод кода в порт В
rjmp Main		;возврат к опросу порта А
