.include "m16def.inc" ;ATmega16
.cseg
.org 0x850	;адрес ячейки памяти 850
ldi r16, 0xFF
out DDRB, r16	;порт В на вывод 
ldi r16, 0x00
out DDRA, r16	;порт А на ввод

Main:	;основной цикл
  in r16, PINA		;запись в регистр r16 сообщения с порта А
	sts 0x450, r16	;запись сообщения в ОЗУ
	;сохранение информационных битов
	mov r17,r16		;запись сообщения в регистр r17
	andi r17,0x01		;выделение первого информационного бита

	mov r18,r16		;запись сообщения в регистр r18
	andi r18,0x01		;выделение второго информационного бита
	lsr r18		;сдвиг бита вправо в первый разряд

	mov r19,r16		;запись сообщения в регистр r19
	andi r19,0x04		;выделение третьего информационного бита
	lsr r19		
	lsr r19		;сдвиг бита вправо в первый разряд

	mov r20,r16		;запись сообщения в регистр r20
	andi r20,0x08		;выделение четвертого информационного бита
	lsr r20
	lsr r20	
	lsr r20		;сдвиг бита вправо в первый разряд
;сохранение проверочных битов
	mov r21,r17		;запись первого информационного бита в регистр r21
	eor r21, r18	
	eor r21, r20		;вычисление первого проверочного бита

	mov r21,r17		;запись первого информационного бита в регистр r21
	eor r21, r18	
	eor r21, r20		;вычисление первого проверочного бита

	mov r22,r17		;запись первого информационного бита в регистр r22
	eor r22, r19	
	eor r22, r20		;вычисление второго проверочного бита
	lsl r22		;сдвиг бита во второй разряд

	mov r23,r18		;запись второго информационного бита в регистр r23
	eor r23, r19	
	eor r23, r20		;вычисление второго проверочного бита
	lsl r23
	lsl r23		;сдвиг бита в третий разряд
  ;формирование кода Хемминга
	;сдвиг информационных битов в регистре r16 на новые позиции
	lsl r16
	lsl r16
	lsl r16
	;запись проверочных битов
	or r16, r21
	or r16, r22
	or r16, r23
  ;вывод закодированных данных
	sts 0x452, r16	;запись кода в ОЗУ
	out PORTB, r16	;вывод кода в порт В
    rjmp Main		;возврат к опросу порта А
